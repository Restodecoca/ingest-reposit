"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
var react_1 = require("react");
var useEventListener_1 = __importDefault(require("./useEventListener"));
var isBrowser = typeof document !== 'undefined';
/**
 * Returns a stateful value synchronized with localStorage, and a function to update it.
 *
 * @param {string} key localStorage key
 * @param {*} initialState Initial state
 */
function useLocalStorage(key, initialState) {
    var _a = (0, react_1.useState)(function () {
        if (!isBrowser) {
            return initialState;
        }
        var rawValue = localStorage.getItem(key);
        return rawValue !== null ? JSON.parse(rawValue) : initialState;
    }), value = _a[0], setValue = _a[1];
    var onChange = (0, react_1.useCallback)(function (nextValueOrFunction) {
        var nextValue = nextValueOrFunction instanceof Function ? nextValueOrFunction(value) : nextValueOrFunction;
        if (isBrowser) {
            localStorage.setItem(key, JSON.stringify(nextValue));
        }
        setValue(nextValue);
    }, [key, value]);
    var onStorage = (0, react_1.useCallback)(function (event) {
        if (event.key !== key) {
            return;
        }
        var rawValue = event.newValue;
        var nextValue = rawValue !== null ? JSON.parse(rawValue) : null;
        if (nextValue !== value) {
            setValue(nextValue);
        }
    }, [key, value]);
    (0, useEventListener_1.default)(isBrowser ? window : null, 'storage', onStorage);
    return [value, onChange];
}
exports.default = useLocalStorage;
